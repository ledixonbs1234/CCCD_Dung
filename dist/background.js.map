{"version":3,"file":"background.js","mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./src/background/background.ts"],"sourcesContent":["\"use strict\";\n// background.ts (MV3 service worker)\n// ==================== MODAL DETECTION SYSTEM ====================\n// Listener Ä‘á»ƒ phÃ¡t hiá»‡n modal sau khi trang reload\nchrome.tabs.onUpdated.addListener((updatedTabId, info, _tab) => {\n    if (info.status === \"complete\") {\n        chrome.storage.session.get(['waitingForModalTab']).then(({ waitingForModalTab }) => {\n            if (waitingForModalTab === updatedTabId) {\n                console.log(\"âœ… Background: Tab reloaded completely, injecting modal detector...\");\n                // Inject script Ä‘á»ƒ kiá»ƒm tra modal\n                chrome.scripting.executeScript({\n                    target: { tabId: updatedTabId },\n                    func: () => {\n                        // Helper function: Ä‘á»£i element xuáº¥t hiá»‡n\n                        function waitForElm(selector, timeout = 10000) {\n                            return new Promise((resolve) => {\n                                const element = document.querySelector(selector);\n                                if (element) {\n                                    console.log(`âœ… Modal \"${selector}\" Ä‘Ã£ tá»“n táº¡i ngay láº­p tá»©c!`);\n                                    return resolve(element);\n                                }\n                                const observer = new MutationObserver(() => {\n                                    const element = document.querySelector(selector);\n                                    if (element) {\n                                        console.log(`âœ… Modal \"${selector}\" xuáº¥t hiá»‡n sau khi chá»!`);\n                                        observer.disconnect();\n                                        resolve(element);\n                                    }\n                                });\n                                observer.observe(document.body, {\n                                    childList: true,\n                                    subtree: true,\n                                });\n                                setTimeout(() => {\n                                    observer.disconnect();\n                                    console.log(`âš ï¸ Timeout waiting for modal \"${selector}\"`);\n                                    resolve(null);\n                                }, timeout);\n                            });\n                        }\n                        // Báº¯t Ä‘áº§u chá» modal\n                        console.log(\"ðŸ” Starting modal detection...\");\n                        waitForElm(\"#flash-overlay-modal\").then((elm) => {\n                            if (elm) {\n                                console.log(\"âœ… MODAL DETECTED! Sending message to popup...\");\n                                chrome.runtime.sendMessage({\n                                    action: \"modalDetected\",\n                                    success: true\n                                });\n                            }\n                            else {\n                                console.log(\"âŒ Modal not found within timeout\");\n                                chrome.runtime.sendMessage({\n                                    action: \"modalDetected\",\n                                    success: false,\n                                    reason: \"timeout\"\n                                });\n                            }\n                        });\n                    }\n                }).then(() => {\n                    console.log(\"âœ“ Background: Modal detector script injected successfully\");\n                }).catch(err => {\n                    console.error(\"âŒ Background: Failed to inject modal detector:\", err);\n                });\n                // XÃ³a flag session sau khi inject\n                chrome.storage.session.remove(['waitingForModalTab']);\n            }\n        });\n    }\n});\n// Listener nháº­n message tá»« injected script vÃ  forward Ä‘áº¿n popup\nchrome.runtime.onMessage.addListener((message, _sender, _sendResponse) => {\n    if (message.action === \"modalDetected\") {\n        console.log(\"ðŸ“¨ Background received modal detection result:\", message);\n        // Message nÃ y sáº½ Ä‘Æ°á»£c forward Ä‘áº¿n popup qua runtime.onMessage\n        // Popup listener sáº½ nháº­n vÃ  xá»­ lÃ½\n    }\n});\nconsole.log(\"âœ… CCCD Background Service Worker loaded - Modal detection ready\");\n"],"names":[],"sourceRoot":""}
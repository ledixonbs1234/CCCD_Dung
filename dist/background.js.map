{"version":3,"file":"background.js","mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack:///./src/background/background.ts"],"sourcesContent":["\"use strict\";\n// background.ts (MV3 service worker)\n// ==================== MODAL DETECTION SYSTEM ====================\n// Listener Ä‘á»ƒ phÃ¡t hiá»‡n modal sau khi trang reload\nchrome.tabs.onUpdated.addListener((updatedTabId, info, _tab) => {\n    if (info.status === \"complete\") {\n        chrome.storage.session.get(['waitingForModalTab']).then(({ waitingForModalTab }) => {\n            if (waitingForModalTab === updatedTabId) {\n                console.log(\"âœ… Background: Tab reloaded completely, injecting modal detector...\");\n                // Inject script Ä‘á»ƒ kiá»ƒm tra modal\n                chrome.scripting.executeScript({\n                    target: { tabId: updatedTabId },\n                    func: () => {\n                        // Helper function: Ä‘á»£i element xuáº¥t hiá»‡n\n                        function waitForElm(selector, timeout = 10000) {\n                            return new Promise((resolve) => {\n                                const element = document.querySelector(selector);\n                                if (element) {\n                                    console.log(`âœ… Modal \"${selector}\" Ä‘Ã£ tá»“n táº¡i ngay láº­p tá»©c!`);\n                                    return resolve(element);\n                                }\n                                const observer = new MutationObserver(() => {\n                                    const element = document.querySelector(selector);\n                                    if (element) {\n                                        console.log(`âœ… Modal \"${selector}\" xuáº¥t hiá»‡n sau khi chá»!`);\n                                        observer.disconnect();\n                                        resolve(element);\n                                    }\n                                });\n                                observer.observe(document.body, {\n                                    childList: true,\n                                    subtree: true,\n                                });\n                                setTimeout(() => {\n                                    observer.disconnect();\n                                    console.log(`âš ï¸ Timeout waiting for modal \"${selector}\"`);\n                                    resolve(null);\n                                }, timeout);\n                            });\n                        }\n                        // Báº¯t Ä‘áº§u chá» modal\n                        console.log(\"ðŸ” Starting modal detection...\");\n                        waitForElm(\"#flash-overlay-modal\").then((elm) => {\n                            if (elm) {\n                                console.log(\"âœ… MODAL DETECTED! Sending message to background...\");\n                                // âœ… Send message vá» background (script context cÃ³ thá»ƒ gá»i chrome.runtime)\n                                chrome.runtime.sendMessage({\n                                    action: \"modalDetected\",\n                                    success: true,\n                                    timestamp: Date.now()\n                                });\n                            }\n                            else {\n                                console.log(\"âŒ Modal not found within timeout\");\n                                chrome.runtime.sendMessage({\n                                    action: \"modalDetected\",\n                                    success: false,\n                                    reason: \"timeout\",\n                                    timestamp: Date.now()\n                                });\n                            }\n                        });\n                    }\n                }).then(() => {\n                    console.log(\"âœ“ Background: Modal detector script injected successfully\");\n                    // âŒ KHÃ”NG XÃ“A FLAG á»ž ÄÃ‚Y - Ä‘á»ƒ script trong tab tá»± xÃ³a sau khi detect xong\n                }).catch(err => {\n                    console.error(\"âŒ Background: Failed to inject modal detector:\", err);\n                    // Cleanup flag trÃªn lá»—i\n                    chrome.storage.session.remove(['waitingForModalTab']);\n                });\n            }\n        });\n    }\n});\n// âœ… Listener nháº­n message tá»« modal detector script vÃ  lÆ°u vÃ o storage\nchrome.runtime.onMessage.addListener((message, _sender, _sendResponse) => {\n    if (message.action === \"modalDetected\") {\n        console.log(\"ðŸ“¨ Background received modal detection result:\", message);\n        // LÆ°u káº¿t quáº£ vÃ o storage\n        chrome.storage.session.set({\n            modalDetectionResult: {\n                success: message.success,\n                reason: message.reason,\n                timestamp: message.timestamp || Date.now()\n            }\n        }).then(() => {\n            console.log(\"âœ… Background saved modal result to storage:\", message.success);\n            // Cleanup flag\n            chrome.storage.session.remove(['waitingForModalTab']);\n        });\n    }\n});\nconsole.log(\"âœ… CCCD Background Service Worker loaded - Modal detection ready\");\n"],"names":[],"sourceRoot":""}